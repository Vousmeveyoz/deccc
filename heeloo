--[[
    EXPLODE/BLAST MECHANICS TESTER
    Test berbagai cara explode/kill player via remotes
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- CONFIG
local TARGET_PLAYER = ""  -- Kosongkan untuk auto, atau isi username
local TEST_ALL_PLAYERS = false  -- true = test ke semua player
local DELAY = 0.2

-- Utils
local function log(msg)
    print("[EXPLODE TEST] " .. msg)
end

local function get_targets()
    local targets = {}
    
    if TARGET_PLAYER ~= "" then
        local target = Players:FindFirstChild(TARGET_PLAYER)
        if target then
            table.insert(targets, target)
        end
    elseif TEST_ALL_PLAYERS then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                table.insert(targets, player)
            end
        end
    else
        -- Auto select first player
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                table.insert(targets, player)
                break
            end
        end
    end
    
    return targets
end

local function get_health(player)
    if not player or not player.Character then return nil end
    local hum = player.Character:FindFirstChild("Humanoid")
    return hum and hum.Health or nil
end

local function get_position(player)
    if not player or not player.Character then return nil end
    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    return hrp and hrp.Position or nil
end

local function find_all_remotes()
    local remotes = {}
    
    for _, obj in pairs(ReplicatedStorage:GetDescendants()) do
        if obj:IsA("RemoteEvent") then
            table.insert(remotes, obj)
        end
    end
    
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("RemoteEvent") then
            table.insert(remotes, obj)
        end
    end
    
    return remotes
end

-- MAIN
print("\n" .. string.rep("=", 60))
log("EXPLODE/BLAST MECHANICS TESTER - START")
print(string.rep("=", 60))

local targets = get_targets()
if #targets == 0 then
    log("ERROR: Tidak ada target!")
    return
end

log(string.format("Target count: %d", #targets))
for i, target in pairs(targets) do
    log(string.format("  [%d] %s (HP: %s)", i, target.Name, tostring(get_health(target))))
end

-- STEP 1: Test Explosion-related remotes
print("\n" .. string.rep("=", 60))
log("STEP 1: TESTING EXPLOSION/BLAST REMOTES")
print(string.rep("=", 60))

local explode_keywords = {
    "explode", "explosion", "blast", "boom", "detonate",
    "nuke", "bomb", "grenade", "c4", "tnt"
}

local all_remotes = find_all_remotes()
local explode_remotes = {}

for _, remote in pairs(all_remotes) do
    local name = remote.Name:lower()
    
    for _, keyword in pairs(explode_keywords) do
        if name:find(keyword) then
            table.insert(explode_remotes, remote)
            log("üîç Found: " .. remote.Name)
            break
        end
    end
end

log(string.format("\nTesting %d explosion remotes...\n", #explode_remotes))

for i, remote in pairs(explode_remotes) do
    log(string.format("[%d/%d] Testing: %s", i, #explode_remotes, remote.Name))
    
    for _, target in pairs(targets) do
        local before = get_health(target)
        local pos = get_position(target)
        
        if pos then
            -- Test berbagai kombinasi argument
            pcall(function() remote:FireServer(target) end)
            pcall(function() remote:FireServer(target, pos) end)
            pcall(function() remote:FireServer(target, 100) end)
            pcall(function() remote:FireServer(pos) end)
            pcall(function() remote:FireServer(pos, 100) end)
            pcall(function() remote:FireServer(pos, target) end)
            
            wait(0.3)
            local after = get_health(target)
            
            if before and after then
                if after < before then
                    log(string.format("    üí• %s: DAMAGED! HP %d -> %d", target.Name, before, after))
                    log(string.format("    ‚úÖ WORKING: %s", remote:GetFullName()))
                end
            elseif before and not after then
                log(string.format("    üíÄ %s: KILLED!", target.Name))
                log(string.format("    ‚úÖ KILL REMOTE: %s", remote:GetFullName()))
            end
        end
    end
    
    wait(DELAY)
end

-- STEP 2: Test Pressure/Blast remotes
print("\n" .. string.rep("=", 60))
log("STEP 2: TESTING PRESSURE/BLAST DAMAGE REMOTES")
print(string.rep("=", 60))

local pressure_keywords = {
    "pressure", "blastpressure", "force", "push", "knockback"
}

local pressure_remotes = {}

for _, remote in pairs(all_remotes) do
    local name = remote.Name:lower()
    
    for _, keyword in pairs(pressure_keywords) do
        if name:find(keyword) then
            table.insert(pressure_remotes, remote)
            log("üîç Found: " .. remote.Name)
            break
        end
    end
end

log(string.format("\nTesting %d pressure remotes...\n", #pressure_remotes))

for i, remote in pairs(pressure_remotes) do
    log(string.format("[%d/%d] Testing: %s", i, #pressure_remotes, remote.Name))
    
    for _, target in pairs(targets) do
        local before = get_health(target)
        local pos = get_position(target)
        
        if pos then
            -- Test pressure values
            local pressure_values = {100, 500, 1000, 5000, 10000}
            
            for _, pressure in pairs(pressure_values) do
                pcall(function() remote:FireServer(target, pressure) end)
                pcall(function() remote:FireServer(pos, pressure) end)
                wait(0.1)
            end
            
            wait(0.3)
            local after = get_health(target)
            
            if before and after and after < before then
                log(string.format("    üí• %s: DAMAGED!", target.Name))
                log(string.format("    ‚úÖ WORKING: %s", remote:GetFullName()))
            end
        end
    end
    
    wait(DELAY)
end

-- STEP 3: Brute force dengan Position argument
print("\n" .. string.rep("=", 60))
log("STEP 3: BRUTE FORCE WITH POSITION ARGS")
print(string.rep("=", 60))

log(string.format("Testing %d total remotes with position-based args...\n", #all_remotes))

local working_remotes = {}

for i, remote in pairs(all_remotes) do
    for _, target in pairs(targets) do
        local before = get_health(target)
        local pos = get_position(target)
        
        if pos then
            -- Try position-based explosions
            pcall(function() remote:FireServer(pos) end)
            pcall(function() remote:FireServer(pos, 100) end)
            pcall(function() remote:FireServer(pos, Vector3.new(0, 0, 0)) end)
            pcall(function() remote:FireServer(target, pos) end)
            pcall(function() remote:FireServer(target, pos, 100) end)
            
            wait(0.15)
            local after = get_health(target)
            
            if before and after and after < before then
                local damage = before - after
                table.insert(working_remotes, {
                    name = remote.Name,
                    path = remote:GetFullName(),
                    damage = damage,
                    target = target.Name
                })
                log(string.format("[%d] üí• %s -> %s: -%d HP", i, remote.Name, target.Name, damage))
            elseif before and not after then
                table.insert(working_remotes, {
                    name = remote.Name,
                    path = remote:GetFullName(),
                    damage = "KILL",
                    target = target.Name
                })
                log(string.format("[%d] üíÄ %s -> %s: KILLED!", i, remote.Name, target.Name))
            end
        end
    end
    
    if i % 20 == 0 then
        log(string.format("Progress: %d/%d", i, #all_remotes))
    end
    
    wait(0.05)
end

-- STEP 4: Test dengan Explosion Instance arguments
print("\n" .. string.rep("=", 60))
log("STEP 4: TESTING WITH EXPLOSION PROPERTIES")
print(string.rep("=", 60))

log("Testing remotes dengan explosion properties...\n")

for i, remote in pairs(all_remotes) do
    for _, target in pairs(targets) do
        local pos = get_position(target)
        
        if pos then
            local before = get_health(target)
            
            -- Test dengan explosion-like args
            pcall(function()
                remote:FireServer({
                    Position = pos,
                    BlastRadius = 100,
                    BlastPressure = 500000
                })
            end)
            
            pcall(function()
                remote:FireServer(pos, 100, 500000)  -- position, radius, pressure
            end)
            
            wait(0.2)
            local after = get_health(target)
            
            if before and after and after < before then
                log(string.format("üí• %s works with explosion properties!", remote.Name))
                table.insert(working_remotes, {
                    name = remote.Name,
                    path = remote:GetFullName(),
                    type = "Explosion Properties"
                })
            end
        end
    end
    
    wait(0.05)
end

-- HASIL
print("\n" .. string.rep("=", 60))
log("HASIL TESTING")
print(string.rep("=", 60))

if #working_remotes > 0 then
    log(string.format("\n‚úÖ DITEMUKAN %d WORKING REMOTES:\n", #working_remotes))
    
    for i, remote in pairs(working_remotes) do
        log(string.format("[%d] %s", i, remote.name))
        log(string.format("    Path: %s", remote.path))
        if remote.damage then
            log(string.format("    Damage: %s", tostring(remote.damage)))
        end
        if remote.target then
            log(string.format("    Target: %s", remote.target))
        end
        if remote.type then
            log(string.format("    Type: %s", remote.type))
        end
        log(string.format("    Usage: game:GetService('ReplicatedStorage'):FindFirstChild('%s'):FireServer(target.Position, 100)\n", remote.name))
    end
else
    log("\n‚ùå Tidak ada remote explode/blast yang berhasil")
    log("\nKemungkinan:")
    log("‚Ä¢ Game pakai method lain untuk explode (bukan RemoteEvent)")
    log("‚Ä¢ Perlu GamePass/Permission khusus")
    log("‚Ä¢ Server-side sudah punya validasi ketat")
end

print("\n" .. string.rep("=", 60))
log("TESTING SELESAI")
print(string.rep("=", 60))
